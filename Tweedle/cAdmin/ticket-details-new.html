<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <title>New Ticket Assignment</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --light: #F9F9F9;
            --blue: #3C91E6;
            --light-blue: #CFE8FF;
            --grey: #eee;
            --dark-grey: #9c9c9c;
            --dark: #342E37;
            --red: #DB504A;
            --yellow: #ecbe25;
            --light-yellow: #FFF2C6;
            --orange: #FD7238;
            --green: #28c742;
            --light-green: #d3f9df;
            --text-primary: #262a39;
        }

        body {
            background: var(--grey);
            padding: 20px;
            min-height: 100vh;
        }

        /* Demo table */
        .demo-table {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .demo-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .demo-table th, .demo-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--grey);
        }

        .demo-table tbody tr {
            cursor: pointer;
            transition: background 0.2s;
        }

        .demo-table tbody tr:hover {
            background: var(--light-blue);
        }

        .status-badge-table {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: var(--light-yellow);
            color: var(--orange);
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal Container */
        .modal-container {
            background: white;
            border-radius: 20px;
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        /* Modal Header */
        .modal-header {
            background: linear-gradient(135deg, var(--orange) 0%, #e65c2e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-header-left {
            flex: 1;
        }

        .modal-header-left h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header-left p {
            font-size: 14px;
            opacity: 0.95;
            margin-bottom: 12px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.25);
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* Modal Body */
        .modal-body {
            padding: 25px 30px;
            overflow-y: auto;
            flex: 1;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .info-item {
            background: var(--light);
            padding: 12px 18px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .info-item:hover {
            background: var(--light-blue);
            transform: translateY(-2px);
        }

        .info-label {
            font-size: 10px;
            color: var(--dark-grey);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .info-value {
            font-size: 14px;
            color: var(--dark);
            font-weight: 600;
        }

        .priority-high { color: var(--red); }
        .priority-medium { color: var(--orange); }
        .priority-low { color: var(--green); }

        /* Section */
        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 12px;
            padding-left: 12px;
            border-left: 4px solid var(--orange);
        }

        .description-box {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            line-height: 1.7;
            color: var(--text-primary);
            font-size: 13px;
        }

        /* Assignment Section - Featured */
        .assignment-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid var(--blue);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .assignment-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .assignment-title i {
            color: var(--blue);
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            display: block;
        }

        .form-label .required {
            color: var(--red);
            margin-left: 2px;
        }

        .developer-select-wrapper {
            position: relative;
        }

        .developer-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            color: var(--dark);
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23666' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        .developer-select:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(60, 145, 230, 0.1);
        }

        .developer-option {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ticket-count {
            background: var(--light-blue);
            color: var(--blue);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .developer-info {
            background: white;
            border: 2px solid var(--light-blue);
            border-radius: 10px;
            padding: 15px;
            margin-top: 12px;
            display: none;
        }

        .developer-info.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .developer-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .dev-stat {
            text-align: center;
        }

        .dev-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--blue);
            display: block;
        }

        .dev-stat-label {
            font-size: 11px;
            color: var(--dark-grey);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .comment-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 13px;
            font-family: 'Poppins', sans-serif;
            color: var(--dark);
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s;
        }

        .comment-textarea:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(60, 145, 230, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 12px 16px;
            border-radius: 10px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-group:hover {
            border-color: var(--blue);
            background: var(--light-blue);
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--blue);
        }

        .checkbox-group label {
            font-size: 13px;
            font-weight: 500;
            color: var(--dark);
            cursor: pointer;
            flex: 1;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-assign {
            background: linear-gradient(135deg, var(--green) 0%, #20a83a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 199, 66, 0.3);
        }

        .btn-assign:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 199, 66, 0.4);
        }

        .btn-reject {
            background: linear-gradient(135deg, var(--red) 0%, #c93d37 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(219, 80, 74, 0.3);
        }

        .btn-reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(219, 80, 74, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Confirmation Modal */
        .confirmation-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease;
        }

        .confirmation-overlay.active {
            display: flex;
        }

        .confirmation-box {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s ease;
        }

        .confirmation-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin: 0 auto 20px;
        }

        .confirmation-icon.success {
            background: var(--light-green);
            color: var(--green);
        }

        .confirmation-icon.danger {
            background: #ffe5e5;
            color: var(--red);
        }

        .confirmation-title {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 12px;
            color: var(--dark);
        }

        .confirmation-message {
            font-size: 14px;
            text-align: center;
            color: var(--dark-grey);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirmation-details {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .confirmation-details p {
            font-size: 13px;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .confirmation-details p:last-child {
            margin-bottom: 0;
        }

        .confirmation-details strong {
            font-weight: 600;
            color: var(--blue);
        }

        .confirmation-buttons {
            display: flex;
            gap: 12px;
        }

        .btn-confirm, .btn-cancel {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-confirm {
            background: var(--green);
            color: white;
        }

        .btn-confirm:hover {
            background: #20a83a;
        }

        .btn-confirm.danger {
            background: var(--red);
        }

        .btn-confirm.danger:hover {
            background: #c93d37;
        }

        .btn-cancel {
            background: var(--grey);
            color: var(--dark);
        }

        .btn-cancel:hover {
            background: #ddd;
        }

        /* Attachments */
        .attachments-area {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
        }

        .attachment-item {
            background: white;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }

        .attachment-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateX(4px);
        }

        .attachment-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .attachment-icon.pdf {
            background: #ffe5e5;
            color: #e74c3c;
        }

        .attachment-icon.doc {
            background: #e3f2fd;
            color: #3498db;
        }

        .attachment-icon.img {
            background: #e8f5e9;
            color: #27ae60;
        }

        .attachment-info {
            flex: 1;
        }

        .attachment-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .attachment-meta {
            font-size: 11px;
            color: var(--dark-grey);
        }

        .attachment-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: var(--light);
            color: var(--dark-grey);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: var(--blue);
            color: white;
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .modal-container {
                max-height: 95vh;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .developer-info-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .attachment-item {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Demo Table -->
    <div class="demo-table">
        <h2 style="margin-bottom: 20px;">New Tickets - Click to Review & Assign</h2>
        <table>
            <thead>
                <tr>
                    <th>Ticket ID</th>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Priority</th>
                </tr>
            </thead>
            <tbody>
                <tr onclick="openTicketModal('GMEC25010001', 'Wallet Option Agents', 'New', 'High')">
                    <td>GMEC25010001</td>
                    <td>Wallet Option Agents</td>
                    <td><span class="status-badge-table">New</span></td>
                    <td>High</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Ticket Modal -->
    <div class="modal-overlay" id="ticketModal">
        <div class="modal-container">
            <!-- Header -->
            <div class="modal-header">
                <div class="modal-header-left">
                    <h2>
                        <i class='bx bx-receipt'></i>
                        <span id="modalTicketId">GMEC25010001</span>
                    </h2>
                    <p id="modalSubject">Wallet Option Agents</p>
                    <span class="status-badge" id="modalStatus">New Ticket</span>
                </div>
                <button class="close-btn" onclick="closeTicketModal()">
                    <i class='bx bx-x'></i>
                </button>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <!-- Info Grid -->
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Ticket Maker</div>
                        <div class="info-value">Rahul R Nair</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Issue Date</div>
                        <div class="info-value">24-12-2025</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Priority</div>
                        <div class="info-value priority-high">High</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Category</div>
                        <div class="info-value">Integration</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Client</div>
                        <div class="info-value">GMEC</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Department</div>
                        <div class="info-value">Development</div>
                    </div>
                </div>

                <!-- Description -->
                <div class="section">
                    <h3 class="section-title">Description</h3>
                    <div class="description-box">
                        Need to implement wallet payment options for agents in the system. This includes integration with multiple payment gateways, transaction history tracking, and automated reconciliation features. The implementation should support multiple currencies and include proper error handling for failed transactions.
                    </div>
                </div>

                <!-- Attachments -->
                <div class="section">
                    <h3 class="section-title">Attachments</h3>
                    <div class="attachments-area">
                        <div class="attachment-item">
                            <div class="attachment-icon pdf">
                                <i class='bx bxs-file-pdf'></i>
                            </div>
                            <div class="attachment-info">
                                <div class="attachment-name">wallet_specifications.pdf</div>
                                <div class="attachment-meta">2.4 MB</div>
                            </div>
                            <div class="attachment-actions">
                                <button class="icon-btn" title="Download">
                                    <i class='bx bx-download'></i>
                                </button>
                                <button class="icon-btn" title="View">
                                    <i class='bx bx-show'></i>
                                </button>
                            </div>
                        </div>
                        <div class="attachment-item">
                            <div class="attachment-icon doc">
                                <i class='bx bxs-file-doc'></i>
                            </div>
                            <div class="attachment-info">
                                <div class="attachment-name">technical_requirements.docx</div>
                                <div class="attachment-meta">1.8 MB</div>
                            </div>
                            <div class="attachment-actions">
                                <button class="icon-btn" title="Download">
                                    <i class='bx bx-download'></i>
                                </button>
                                <button class="icon-btn" title="View">
                                    <i class='bx bx-show'></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assignment Section -->
                <div class="assignment-section">
                    <div class="assignment-title">
                        <i class='bx bx-user-check'></i>
                        Assign Developer
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Select Developer <span class="required">*</span>
                        </label>
                        <select class="developer-select" id="developerSelect" onchange="showDeveloperInfo()">
                            <option value="">-- Choose Developer --</option>
                            <option value="dev1" data-tickets="5" data-completed="23" data-pending="5">Rajesh Kumar (5 tickets)</option>
                            <option value="dev2" data-tickets="3" data-completed="31" data-pending="3">Priya Sharma (3 tickets)</option>
                            <option value="dev3" data-tickets="7" data-completed="18" data-pending="7">Amit Patel (7 tickets)</option>
                            <option value="dev4" data-tickets="4" data-completed="27" data-pending="4">Sarah Johnson (4 tickets)</option>
                            <option value="dev5" data-tickets="2" data-completed="35" data-pending="2">Michael Chen (2 tickets)</option>
                        </select>

                        <div class="developer-info" id="developerInfo">
                            <div class="developer-info-grid">
                                <div class="dev-stat">
                                    <span class="dev-stat-value" id="devPending">0</span>
                                    <span class="dev-stat-label">Pending</span>
                                </div>
                                <div class="dev-stat">
                                    <span class="dev-stat-value" id="devCompleted">0</span>
                                    <span class="dev-stat-label">Completed</span>
                                </div>
                                <div class="dev-stat">
                                    <span class="dev-stat-value" id="devTotal">0</span>
                                    <span class="dev-stat-label">Total Assigned</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Comments / Remarks</label>
                        <textarea class="comment-textarea" id="assignComment" placeholder="Add any notes or instructions for the developer..."></textarea>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="sendEmail" checked>
                            <label for="sendEmail">Send email notification to assigned developer</label>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-assign" id="assignBtn" onclick="confirmAssignment()" disabled>
                            <i class='bx bx-check-circle'></i>
                            Assign Ticket
                        </button>
                        <button class="btn btn-reject" onclick="confirmRejection()">
                            <i class='bx bx-x-circle'></i>
                            Reject / Close Ticket
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-overlay" id="confirmationModal">
        <div class="confirmation-box">
            <div class="confirmation-icon" id="confirmIcon">
                <i class='bx bx-check'></i>
            </div>
            <h3 class="confirmation-title" id="confirmTitle">Confirm Assignment</h3>
            <p class="confirmation-message" id="confirmMessage">Are you sure you want to proceed?</p>
            <div class="confirmation-details" id="confirmDetails"></div>
            <div class="confirmation-buttons">
                <button class="btn-cancel" onclick="closeConfirmation()">Cancel</button>
                <button class="btn-confirm" id="confirmBtn" onclick="executeAction()">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        let currentAction = '';
        let selectedDeveloper = '';

        // Open Ticket Modal
        function openTicketModal(ticketId, subject, status) {
            document.getElementById('modalTicketId').textContent = ticketId;
            document.getElementById('modalSubject').textContent = subject;
            document.getElementById('modalStatus').textContent = status;
            document.getElementById('ticketModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

// Close Ticket Modal
        function closeTicketModal() {
            document.getElementById('ticketModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            resetForm();
        }

        // Show Developer Stats when selected
        function showDeveloperInfo() {
            const select = document.getElementById('developerSelect');
            const infoDiv = document.getElementById('developerInfo');
            const assignBtn = document.getElementById('assignBtn');
            const selectedOption = select.options[select.selectedIndex];

            if (select.value) {
                document.getElementById('devPending').textContent = selectedOption.getAttribute('data-pending');
                document.getElementById('devCompleted').textContent = selectedOption.getAttribute('data-completed');
                document.getElementById('devTotal').textContent = selectedOption.getAttribute('data-tickets');
                
                infoDiv.classList.add('active');
                assignBtn.disabled = false;
                selectedDeveloper = selectedOption.text;
            } else {
                infoDiv.classList.remove('active');
                assignBtn.disabled = true;
                selectedDeveloper = '';
            }
        }

        // Confirm Assignment Action
        function confirmAssignment() {
            currentAction = 'assign';
            const ticketId = document.getElementById('modalTicketId').textContent;
            
            document.getElementById('confirmIcon').className = 'confirmation-icon success';
            document.getElementById('confirmIcon').innerHTML = "<i class='bx bx-check'></i>";
            document.getElementById('confirmTitle').textContent = 'Confirm Assignment';
            document.getElementById('confirmMessage').textContent = 'You are about to assign this ticket to:';
            document.getElementById('confirmDetails').innerHTML = `
                <p><strong>Ticket:</strong> ${ticketId}</p>
                <p><strong>Developer:</strong> ${selectedDeveloper}</p>
            `;
            document.getElementById('confirmBtn').className = 'btn-confirm';
            document.getElementById('confirmationModal').classList.add('active');
        }

        // Confirm Rejection Action with Mandatory Reason
        function confirmRejection() {
            currentAction = 'reject';
            const ticketId = document.getElementById('modalTicketId').textContent;
            const subject = document.getElementById('modalSubject').textContent;

            document.getElementById('confirmIcon').className = 'confirmation-icon danger';
            document.getElementById('confirmIcon').innerHTML = "<i class='bx bx-error-circle'></i>";
            document.getElementById('confirmTitle').textContent = 'Reject Ticket';
            document.getElementById('confirmMessage').textContent = 'Are you sure you want to reject this ticket? This action cannot be undone.';
            
            // Adding the mandatory textarea to the confirmation details
            document.getElementById('confirmDetails').innerHTML = `
                <p style="margin-bottom: 10px;"><strong>Ticket:</strong> ${ticketId}</p>
                <p style="margin-bottom: 10px;"><strong>Subject:</strong> ${subject}</p>
                <label class="form-label">Rejection Reason <span class="required">*</span></label>
                <textarea id="rejectReason" class="comment-textarea" placeholder="Why is this ticket being rejected?" style="min-height: 80px; border: 1px solid #ddd;"></textarea>
                <p id="rejectError" style="color: var(--red); font-size: 11px; margin-top: 5px; display: none;">Reason is required to proceed.</p>
            `;
            
            document.getElementById('confirmBtn').className = 'btn-confirm danger';
            document.getElementById('confirmationModal').classList.add('active');
        }

        // Close Confirmation Overlay
        function closeConfirmation() {
            document.getElementById('confirmationModal').classList.remove('active');
        }

        // Execute the Action (With Validation)
        function executeAction() {
            const ticketId = document.getElementById('modalTicketId').textContent;
            
            if (currentAction === 'assign') {
                alert(`Ticket ${ticketId} has been successfully assigned to ${selectedDeveloper}.`);
                finishProcess();
            } else if (currentAction === 'reject') {
                const reason = document.getElementById('rejectReason').value.trim();
                const errorMsg = document.getElementById('rejectError');
                
                if (reason === "") {
                    // Validation: Rejection reason must be filled
                    errorMsg.style.display = 'block';
                    document.getElementById('rejectReason').style.borderColor = 'var(--red)';
                    return; // Prevent closing the modal
                }
                
                alert(`Ticket ${ticketId} has been rejected. Reason: ${reason}`);
                finishProcess();
            }
        }

        function finishProcess() {
            closeConfirmation();
            closeTicketModal();
            // In a real application, logic to update the UI table would go here
        }

        // Reset form fields
        function resetForm() {
            document.getElementById('developerSelect').value = '';
            document.getElementById('developerInfo').classList.remove('active');
            document.getElementById('assignComment').value = '';
            document.getElementById('assignBtn').disabled = true;
            document.getElementById('sendEmail').checked = true;
        }

        // Close modal if user clicks outside of container
        window.onclick = function(event) {
            const modal = document.getElementById('ticketModal');
            if (event.target == modal) {
                closeTicketModal();
            }
        }
    </script>
</body>
</html>